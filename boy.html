<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–°–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ ‚Äî –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞</title>
  <style>
    :root{
      --bg:#0f1220; --panel:#151935; --panel-2:#1b2042; --ink:#e8ebff; --muted:#a9b0d5;
      --accent:#6c8bff; --accent-2:#8de1ff; --bad:#ff6b6b; --good:#4adf99; --warn:#ffcc66;
      --card:#1d234b; --shadow:0 8px 24px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 600px at 20% -10%,#1f2460 0%,transparent 40%) ,
                      radial-gradient(1100px 700px at 120% 20%,#1b3f66 0%,transparent 45%), var(--bg);
         color:var(--ink); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    h1{font-size:28px;margin:0;font-weight:800;letter-spacing:.3px}
    .subtitle{color:var(--muted);font-size:14px}
    .row{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    .panel{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid #202759;border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .stats{display:flex;gap:12px;flex-wrap:wrap}
    .chip{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:999px;font-weight:700;display:flex;align-items:center;gap:8px}
    .chip .dot{width:10px;height:10px;border-radius:50%}
    .dot.conf{background:var(--good)}
    .dot.stress{background:var(--warn)}
    .dot.stage{background:var(--accent)}

    .hands{display:grid;grid-template-columns:1fr;gap:12px}
    .zone-title{font-size:12px;text-transform:uppercase;letter-spacing:.12em;color:var(--muted);margin:4px 4px 8px}

    .cards{display:flex;flex-wrap:wrap;gap:12px}
    .card{background:var(--card);border:1px solid #2a326a;border-radius:14px;padding:12px;width:180px;min-height:120px;position:relative;box-shadow:0 4px 14px rgba(0,0,0,.25)}
    .card h4{margin:0 0 6px;font-size:15px}
    .card p{margin:0;color:#c8cff5;font-size:13px;line-height:1.3}
    .badge{position:absolute;top:8px;right:8px;font-size:10px;text-transform:uppercase;letter-spacing:.12em;padding:4px 6px;border-radius:8px;border:1px solid rgba(255,255,255,.15)}
    .badge.recruiter{background:rgba(255,107,107,.12);border-color:#ff6b6b;color:#ffdada}
    .badge.candidate{background:rgba(76,223,153,.12);border-color:#4adf99;color:#d7ffea}

    .play-area{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
    .log{height:220px;overflow:auto;background:rgba(0,0,0,.25);border:1px solid #28306b;border-radius:12px;padding:10px;font-size:13px}
    .log p{margin:6px 0}

    .controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    button{background:linear-gradient(180deg,#2c3e9e,#25388b);border:1px solid #3b4abb;color:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700}
    button:hover{filter:brightness(1.05)}
    button.ghost{background:transparent;border-color:#3b4abb99}
    button.danger{background:linear-gradient(180deg,#a93838,#8b2b2b);border-color:#c14d4d}
    button.success{background:linear-gradient(180deg,#1c7e53,#166345);border-color:#2ca774}

    .stagebar{display:flex;gap:8px;margin:8px 0 0}
    .stage{flex:1;height:8px;background:#222a58;border:1px solid #2a326a;border-radius:99px;overflow:hidden}
    .stage>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2))}

    .small{font-size:12px;color:var(--muted)}
    footer{margin-top:12px;color:var(--muted);font-size:12px}
    .hr{height:1px;background:#28306b;border:0;margin:12px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>¬´–°–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ¬ª ‚Äî –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞</h1>
        <div class="subtitle">–°–æ–∏—Å–∫–∞—Ç–µ–ª—å –ø—Ä–æ—Ç–∏–≤ –†–µ–∫—Ä—É—Ç–µ—Ä–∞. –ù–µ–±–æ–ª—å—à–æ–π, –∑–ª–æ–π –∏ –∏—Ä–æ–Ω–∏—á–Ω—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø (–ø–µ—Ä–µ–∫–æ—Å –≤ –ø–æ–ª—å–∑—É –†–µ–∫—Ä—É—Ç–µ—Ä–∞).</div>
      </div>
      <div class="controls">
        <button id="restart">–ù–æ–≤–∞—è –ø–∞—Ä—Ç–∏—è</button>
        <button id="resetTotals" class="ghost">–°–±—Ä–æ—Å–∏—Ç—å –æ–±—â–∏–π —Å—á—ë—Ç</button>
      </div>
    </header>

    <section class="row">
      <div class="panel">
        <div class="stats">
          <div class="chip"><span class="dot conf"></span> –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: <span id="confidence">10</span></div>
          <div class="chip"><span class="dot stress"></span> –°—Ç—Ä–µ—Å—Å —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞: <span id="stress">0</span></div>
          <div class="chip"><span class="dot stage"></span> –≠—Ç–∞–ø: <span id="stageName">–¢–µ–ª–µ—Ñ–æ–Ω</span></div>
          <div class="chip"><span class="dot conf"></span> –û—Ñ—Ñ–µ—Ä—ã: <span id="offerSession">0</span> / <span id="offerTotal">0</span></div>
          <div class="chip"><span class="dot stress"></span> –û—Ç–∫–∞–∑—ã: <span id="refuseSession">0</span> / <span id="refuseTotal">0</span></div>
          <div class="chip"><span class="dot stage"></span> üåç –ì–ª–æ–±–∞–ª—å–Ω–æ ‚Äî –æ—Ñ—Ñ–µ—Ä—ã: <span id="offerGlobal">0</span>, –æ—Ç–∫–∞–∑—ã: <span id="refuseGlobal">0</span></div>
        </div>
        <div class="stagebar">
          <div class="stage"><span id="stageFill" style="width:0%"></span></div>
        </div>

        <div class="hr"></div>

        <div class="hands">
          <div>
            <div class="zone-title">–ö–∞—Ä—Ç–∞ —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞ (—Ö–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞)</div>
            <div id="recruiter-play" class="cards"></div>
          </div>
          <div>
            <div class="zone-title">–í–∞—à–∏ –∫–∞—Ä—Ç—ã (–≤—ã–±–µ—Ä–∏—Ç–µ, —á–µ–º –æ—Ç–≤–µ—Ç–∏—Ç—å) ‚Äî –Ω–∞ —Ä—É–∫–µ –º–∞–∫—Å–∏–º—É–º 2</div>
            <div id="candidate-hand" class="cards"></div>
          </div>
        </div>

        <div class="play-area">
          <div class="controls" id="actionButtons"></div>
          <div class="log" id="log"></div>
        </div>
      </div>

      <aside class="panel">
        <h3 style="margin:0 0 8px">–ö–∞–∫ –≤—ã–∏–≥—Ä–∞—Ç—å</h3>
        <p class="small">–ü—Ä–æ–π–¥–∏—Ç–µ –≤—Å–µ 4 —ç—Ç–∞–ø–∞: –¢–µ–ª–µ—Ñ–æ–Ω ‚Üí HR ‚Üí –¢–µ—Ö ‚Üí –§–∏–Ω–∞–ª. –ï—Å–ª–∏ –≤–∞—à–∞ ¬´–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å¬ª –æ–ø—É—Å—Ç–∏—Ç—Å—è –¥–æ 0 ‚Äî –≤—ã –≤—ã–±—ã–≤–∞–µ—Ç–µ. –ï—Å–ª–∏ —Å—Ç—Ä–µ—Å—Å —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞ –¥–æ—Ä–∞—Å—Ç—ë—Ç –¥–æ 12 ‚Äî –æ–Ω –≤—ã–Ω—É–∂–¥–µ–Ω –¥–∞—Ç—å –æ—Ñ—Ñ–µ—Ä.</p>
        <div class="hr"></div>
        <h3 style="margin:0 0 8px">–ü–æ–¥—Å–∫–∞–∑–∫–∏</h3>
        <ul class="small">
          <li><b>–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç</b> –±–ª–æ–∫–∏—Ä—É–µ—Ç ¬´–ö–∞–≤–µ—Ä–∑–Ω—ã–π –≤–æ–ø—Ä–æ—Å¬ª.</li>
          <li><b>–û–ø—ã—Ç/–ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ</b> –≥–∞—Å–∏—Ç ¬´–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ¬ª.</li>
          <li><b>–•–∞—Ä–∏–∑–º–∞</b> –æ—Ç–º–µ–Ω—è–µ—Ç ¬´–ú—ã –≤–∞–º –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–º¬ª.</li>
          <li><b>–û—Ç–≥–æ–≤–æ—Ä–∫–∞</b> –æ–¥–∏–Ω —Ä–∞–∑ –æ—Ç–º–µ–Ω—è–µ—Ç –ª—é–±—É—é –∫–∞—Ä—Ç—É.</li>
          <li><b>–í–æ–ø—Ä–æ—Å –≤ –æ—Ç–≤–µ—Ç</b> —Å–Ω–∏–∂–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞.</li>
        </ul>
        <div class="hr"></div>
        <p class="small">–≠—Ç–æ—Ç –ø—Ä–æ—Ç–æ—Ç–∏–ø –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ <i>–Ω–µ—á–µ—Å—Ç–Ω—ã–π</i>: —É —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞ –≤—Å–µ–≥–¥–∞ 3 –∫–∞—Ä—Ç—ã –Ω–∞ —Ä—É–∫–µ, —É –≤–∞—Å ‚Äî 2; —É –Ω–µ–≥–æ –±–æ–ª—å—à–µ ¬´—Ñ–∞—Ç–∞–ª—å–Ω—ã—Ö¬ª –∫–∞—Ä—Ç. –£–¥–∞—á–∏ üòº</p>
      </aside>
    </section>

    <footer>
      –°–¥–µ–ª–∞–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞ –º–µ—Ö–∞–Ω–∏–∫. –ò–¥–µ–∏ –∏ —Ç–µ–∫—Å—Ç—ã –∫–∞—Ä—Ç –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å/–ø–æ–º–µ–Ω—è—Ç—å.
    </footer>
  </div>

  <template id="tpl-card">
    <div class="card">
      <span class="badge">—Ç–∏–ø</span>
      <h4>–ó–∞–≥–æ–ª–æ–≤–æ–∫</h4>
      <p>–û–ø–∏—Å–∞–Ω–∏–µ</p>
    </div>
  </template>

  <script>
  // ==== –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: CountAPI (—Å—É–ø–µ—Ä-–ø—Ä–æ—Å—Ç–æ, –±–µ–∑ –±—ç–∫–µ–Ω–¥–∞) ====
  // –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://countapi.xyz
  // Namespace –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å –∫–∞–∫ —É–≥–æ–¥–Ω–æ (–ª—É—á—à–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ):
  const COUNT_NS = 'interview-card-game-public';
  const COUNT_KEY_OFFERS = 'offers';
  const COUNT_KEY_REFUSALS = 'refusals';

  const STAGES = ["–¢–µ–ª–µ—Ñ–æ–Ω", "HR", "–¢–µ—Ö", "–§–∏–Ω–∞–ª"];
  const MAX_CONF = 10;
  const WIN_STRESS = 12; // –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞
  const STORE_KEY = 'interview_game_stats_v1'; // –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏
  const HAND_R = 3; // recruiter hand size
  const HAND_C = 2; // candidate hand size

  // --- Card factories ---
  function recruiterDeck() {
    return shuffle([
      {id:'rq1', name:'–ö–∞–≤–µ—Ä–∑–Ω—ã–π –≤–æ–ø—Ä–æ—Å', type:'trick', text:'–ü–æ—á–µ–º—É –≤—ã —É—à–ª–∏ —Å –ø—Ä–æ—à–ª–æ–π —Ä–∞–±–æ—Ç—ã?', effect:{dmg:2}},
      {id:'rq2', name:'–ö–∞–≤–µ—Ä–∑–Ω—ã–π –≤–æ–ø—Ä–æ—Å', type:'trick', text:'–ì–¥–µ –≤—ã –≤–∏–¥–∏—Ç–µ —Å–µ–±—è —á–µ—Ä–µ–∑ 5 –ª–µ—Ç?', effect:{dmg:2}},
      {id:'rna1', name:'–ù–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ', type:'badcond', text:'–†–∞–±–æ—Ç–∞ 24/7, –Ω–æ –∫–æ–º–∞–Ω–¥–∞ –¥—Ä—É–∂–Ω–∞—è!', effect:{dmg:3}},
      {id:'rna2', name:'–ù–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ', type:'badcond', text:'–û–ø–ª–∞—Ç–∞ –Ω–∏–∂–µ —Ä—ã–Ω–∫–∞, –∑–∞—Ç–æ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã!', effect:{dmg:3}},
      {id:'rt1', name:'–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ', type:'test', text:'–°–¥–µ–ª–∞–π—Ç–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø –∑–∞ 40 —á–∞—Å–æ–≤', effect:{dmg:2}},
      {id:'rt2', name:'–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ', type:'test', text:'20 —Å—Ç—Ä–∞–Ω–∏—Ü —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ', effect:{dmg:2}},
      {id:'rm1', name:'–ú–∞–Ω–∏–ø—É–ª—è—Ü–∏—è', type:'manip', text:'–£ –Ω–∞—Å —Å—É–ø–µ—Ä-–∫–æ–º–∞–Ω–¥–∞, –Ω–∞–¥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å', effect:{dmg:1, stress:+1}},
      {id:'rm2', name:'–ú–∞–Ω–∏–ø—É–ª—è—Ü–∏—è', type:'manip', text:'–ú—ã –∏—â–µ–º –∑–≤–µ–∑–¥—É, –≥–æ—Ç–æ–≤—ã –ª–∏ –ø–∞—Ö–∞—Ç—å?', effect:{dmg:1, stress:+1}},
      {id:'rf1', name:'–ú—ã –≤–∞–º –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–º', type:'calllater', text:'–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π, –º—ã —Å–≤—è–∂–µ–º—Å—è –ø–æ–∑–∂–µ', effect:{fatal:true, needs:'charisma'}},
      {id:'rf2', name:'–ó–∞–º–æ—Ä–æ–∑–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–∏', type:'freeze', text:'–ö–æ–º–ø–∞–Ω–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞ –Ω–∞–π–º', effect:{fatal:true, needs:'excuse'}},
    ]);
  }

  function candidateDeck() {
    return shuffle([
      {id:'cpa1', name:'–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç', type:'prep', text:'–£—à—ë–ª —Ä–∞–¥–∏ —Ä–∞–∑–≤–∏—Ç–∏—è –∏ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á', counter:'trick', heal:2},
      {id:'cpa2', name:'–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç', type:'prep', text:'–ß–µ—Ä–µ–∑ 5 –ª–µ—Ç ‚Äî —É –≤–∞—Å, –Ω–∞ —Å–∏–ª—å–Ω–æ–π —Ä–æ–ª–∏', counter:'trick', heal:2},
      {id:'cpf', name:'–û–ø—ã—Ç/–ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ', type:'portfolio', text:'–ö–µ–π—Å—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã', counter:'test'},
      {id:'cch', name:'–•–∞—Ä–∏–∑–º–∞', type:'charisma', text:'–° –≤–∞–º–∏ –±—ã–ª–æ –ø—Ä–∏—è—Ç–Ω–æ –æ–±—â–∞—Ç—å—Å—è!', counter:'calllater'},
      {id:'cex', name:'–û—Ç–≥–æ–≤–æ—Ä–∫–∞', type:'excuse', text:'–ö–∞–∂–µ—Ç—Å—è, –≤–∞–∫–∞–Ω—Å–∏—è –Ω–µ —Å–æ–≤—Å–µ–º –º–æ—è‚Ä¶', counter:'any'},
      {id:'cqq', name:'–í–æ–ø—Ä–æ—Å –≤ –æ—Ç–≤–µ—Ç', type:'question', text:'–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –∫–æ–º–∞–Ω–¥–µ?', action:{stress:-1}},
    ]);
  }

  // --- Helpers ---
  function shuffle(a){
    const arr = a.slice();
    for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}
    return arr;
  }

  function el(q){return document.querySelector(q)}
  function log(msg){ const p=document.createElement('p'); p.innerHTML=msg; el('#log').appendChild(p); el('#log').scrollTop = el('#log').scrollHeight; }
  function cardEl(card, who){
    const t = document.getElementById('tpl-card');
    const node = t.content.firstElementChild.cloneNode(true);
    node.querySelector('h4').textContent = card.name;
    node.querySelector('p').textContent = card.text;
    const b = node.querySelector('.badge');
    b.textContent = who==='r' ? '–†–µ–∫—Ä—É—Ç–µ—Ä' : '–°–æ–∏—Å–∫–∞—Ç–µ–ª—å';
    b.classList.add(who==='r' ? 'recruiter' : 'candidate');
    node.dataset.id = card.id;
    return node;
  }

  // --- Persistent totals (local) ---
  function loadTotals(){
    try{ const t = JSON.parse(localStorage.getItem(STORE_KEY)||'{}'); return {totalOffers:t.totalOffers||0, totalRefusals:t.totalRefusals||0}; }catch(e){ return {totalOffers:0,totalRefusals:0}; }
  }
  function saveTotals(t){ localStorage.setItem(STORE_KEY, JSON.stringify(t)); }

  // --- Network: global totals via CountAPI ---
  async function countapiCreateIfMissing(){
    try{
      await fetch(`https://api.countapi.xyz/create?namespace=${COUNT_NS}&key=${COUNT_KEY_OFFERS}&value=0`);
      await fetch(`https://api.countapi.xyz/create?namespace=${COUNT_NS}&key=${COUNT_KEY_REFUSALS}&value=0`);
    }catch(e){ /* ignore */ }
  }
  async function fetchGlobalTotals(){
    try{
      const [o,r] = await Promise.all([
        fetch(`https://api.countapi.xyz/get/${COUNT_NS}/${COUNT_KEY_OFFERS}`).then(x=>x.json()).catch(()=>({value:0})),
        fetch(`https://api.countapi.xyz/get/${COUNT_NS}/${COUNT_KEY_REFUSALS}`).then(x=>x.json()).catch(()=>({value:0})),
      ]);
      G.global = {offers: Number(o?.value||0), refusals: Number(r?.value||0)};
      const og = document.getElementById('offerGlobal'); if(og) og.textContent = G.global.offers;
      const rg = document.getElementById('refuseGlobal'); if(rg) rg.textContent = G.global.refusals;
    }catch(e){ console.warn('countapi fetch failed', e); }
  }
  async function sendResult(kind){
    const key = kind==='offer' ? COUNT_KEY_OFFERS : COUNT_KEY_REFUSALS;
    try{ await fetch(`https://api.countapi.xyz/hit/${COUNT_NS}/${key}`); }
    catch(e){ console.warn('countapi hit failed', e); }
  }

  // --- Game State ---
  const G = {
    stageIdx:0,
    confidence:MAX_CONF,
    stress:0,
    rDeck:[], rHand:[], rDiscard:[],
    cDeck:[], cHand:[], cDiscard:[],
    currentRCard:null,
    awaitingResponse:false,
    over:false,
    // session counters
    offersSession:0,
    refusalsSession:0,
    // local totals
    totals: loadTotals(),
    // global totals
    global: {offers:0, refusals:0}
  };

  function updateUI(){
    el('#confidence').textContent = G.confidence;
    el('#stress').textContent = G.stress;
    el('#stageName').textContent = STAGES[G.stageIdx];
    el('#stageFill').style.width = ((G.stageIdx)/ (STAGES.length)) * 100 + '%';
    // counters
    const t = G.totals;
    const os = el('#offerSession'); if(os) os.textContent = G.offersSession;
    const rs = el('#refuseSession'); if(rs) rs.textContent = G.refusalsSession;
    const ot = el('#offerTotal'); if(ot) ot.textContent = t.totalOffers;
    const rt = el('#refuseTotal'); if(rt) rt.textContent = t.totalRefusals;
    const og = document.getElementById('offerGlobal'); if(og) og.textContent = G.global.offers;
    const rg = document.getElementById('refuseGlobal'); if(rg) rg.textContent = G.global.refusals;

    // recruiter play zone
    const rp = el('#recruiter-play'); rp.innerHTML='';
    if(G.currentRCard){ rp.appendChild(cardEl(G.currentRCard,'r')); }

    // candidate hand
    const ch = el('#candidate-hand'); ch.innerHTML='';
    G.cHand.forEach(c=>{
      const n = cardEl(c,'c');
      if(G.awaitingResponse){
        n.style.cursor='pointer';
        n.addEventListener('click',()=> useCandidateCard(c));
      } else {
        n.style.opacity=.8;
      }
      ch.appendChild(n);
    });

    // action buttons
    const ab = el('#actionButtons');
    ab.innerHTML='';
    if(G.awaitingResponse){
      const pass = btn('–ü—Ä–∏–Ω—è—Ç—å —É–¥–∞—Ä', ()=>{resolveRecruiterCard(null)}, 'danger');
      ab.appendChild(pass);
    } else if(!G.over) {
      ab.appendChild(btn('–°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥', nextTurn, 'success'));
    } else {
      ab.appendChild(btn('–°—ã–≥—Ä–∞—Ç—å –µ—â—ë', restart));
    }
  }

  function btn(text, fn, kind){
    const b=document.createElement('button'); b.textContent=text; b.className=kind||''; b.onclick=fn; return b;
  }

  // --- Deck management ---
  function draw(hand, deck, discard, n){
    for(let i=0;i<n;i++){
      if(deck.length===0){
        if(discard.length===0) break;
        deck.push(...shuffle(discard.splice(0)));
      }
      hand.push(deck.shift());
    }
  }

  function removeFromHand(hand, id){
    const idx = hand.findIndex(c=>c.id===id); if(idx>=0) return hand.splice(idx,1)[0];
    return null;
  }

  // --- AI choice (biased) ---
  function recruiterChoose(){
    const fatal = G.rHand.find(c=> (c.type==='calllater' && !candidateHas('charisma')) || (c.type==='freeze' && !candidateHas('excuse')));
    if(fatal) return fatal;
    const order = ['badcond','test','trick','manip','freeze','calllater'];
    for(const t of order){
      const found = G.rHand.find(c=>c.type===t);
      if(found) return found;
    }
    return G.rHand[0];
  }

  function candidateHas(type){
    if(type==='excuse') return G.cHand.some(c=>c.type==='excuse');
    if(type==='charisma') return G.cHand.some(c=>c.type==='charisma');
    return false;
  }

  // --- Turn flow ---
  function nextTurn(){
    if(G.over) return;
    while(G.rHand.length < HAND_R) draw(G.rHand, G.rDeck, G.rDiscard, 1);
    while(G.cHand.length < HAND_C) draw(G.cHand, G.cDeck, G.cDiscard, 1);

    const play = recruiterChoose();
    G.currentRCard = play;
    removeFromHand(G.rHand, play.id);
    el('#recruiter-play').innerHTML='';
    el('#recruiter-play').appendChild(cardEl(play,'r'));

    G.awaitingResponse = true;
    log(`<b>–†–µ–∫—Ä—É—Ç–µ—Ä</b> —Ä–∞–∑—ã–≥—Ä–∞–ª: <i>${play.name}</i> ‚Äî ${play.text}`);
    updateUI();
  }

  function useCandidateCard(card){
    if(!G.awaitingResponse) return;
    const rc = G.currentRCard;
    const canCounter = card.type==='excuse' ||
      (card.type==='prep' && rc.type==='trick') ||
      (card.type==='portfolio' && rc.type==='test') ||
      (card.type==='charisma' && rc.type==='calllater');

    if(card.type==='question'){
      G.stress = Math.max(0, G.stress + (card.action.stress||0));
      log(`<b>–í—ã</b> —Å—ã–≥—Ä–∞–ª–∏ ¬´${card.name}¬ª: —Å—Ç—Ä–µ—Å—Å —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞ ${card.action.stress}`);
      G.cDiscard.push(removeFromHand(G.cHand, card.id));
      updateUI();
      return;
    }

    if(canCounter){
      log(`<b>–í—ã</b> —Å—ã–≥—Ä–∞–ª–∏ ¬´${card.name}¬ª –∏ –Ω–µ–π—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–ª–∏ –∫–∞—Ä—Ç—É —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞.`);
      if(card.heal) {
        G.confidence = Math.min(MAX_CONF, G.confidence + card.heal);
        log(`–í–∞—à–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å –Ω–∞ +${card.heal}.`);
      }
      G.cDiscard.push(removeFromHand(G.cHand, card.id));
      finishCombat('countered');
    } else {
      log(`<span style="color:#ffb3b3">–ö–∞—Ä—Ç–∞ ¬´${card.name}¬ª –Ω–µ –ø–æ–º–æ–≥–ª–∞ –ø—Ä–æ—Ç–∏–≤ ¬´${rc.name}¬ª.</span>`);
      G.cDiscard.push(removeFromHand(G.cHand, card.id));
      resolveRecruiterCard(null);
    }
  }

  function resolveRecruiterCard(force){
    const rc = G.currentRCard; if(!rc) return;
    if(rc.effect.fatal && !force){
      if(rc.type==='calllater' && candidateHas('charisma')){
        log(`–†–µ–∫—Ä—É—Ç–µ—Ä –ø–æ–ø—ã—Ç–∞–ª—Å—è —Å—ã–≥—Ä–∞—Ç—å ¬´–ú—ã –≤–∞–º –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–º¬ª, –Ω–æ —É –≤–∞—Å –µ—Å—Ç—å ¬´–•–∞—Ä–∏–∑–º–∞¬ª. –°—ã–≥—Ä–∞–π—Ç–µ –µ—ë, —á—Ç–æ–±—ã –æ—Ç–º–µ–Ω–∏—Ç—å!`);
        updateUI();
        return;
      }
      if(rc.type==='freeze' && candidateHas('excuse')){
        log(`–í–∞–∫–∞–Ω—Å–∏—è –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞. ¬´–û—Ç–≥–æ–≤–æ—Ä–∫–∞¬ª —Å–ø–æ—Å–æ–±–Ω–∞ —ç—Ç–æ –µ–¥–∏–Ω–æ–∂–¥—ã –æ—Ç–º–µ–Ω–∏—Ç—å.`);
        updateUI();
        return;
      }
    }

    const dmg = rc.effect.dmg||0;
    const stress = rc.effect.stress||0;
    if(dmg){ G.confidence = Math.max(0, G.confidence - dmg); }
    if(stress){ G.stress = Math.min(WIN_STRESS, G.stress + stress); }

    if(rc.effect.fatal){
      log(`<b>–§–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞!</b> ${rc.name}. –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.`);
      endGame(false, rc.name);
      return;
    } else {
      log(`–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ ${dmg?`-${dmg} –∫ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏`:''}${(dmg&&stress)?', ':''}${stress?`+${stress} –∫ —Å—Ç—Ä–µ—Å—Å—É —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞`:''}.`);
      G.rDiscard.push(rc); G.currentRCard=null; G.awaitingResponse=false;
      if(G.confidence<=0){ endGame(false,'–í—ã –≤—ã–≥–æ—Ä–µ–ª–∏'); return; }
      const advance = Math.random()<0.7;
      if(advance){
        G.stageIdx++;
        log(`<b>–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à—ë–Ω.</b> –í—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –¥–∞–ª—å—à–µ.`);
      } else {
        log(`<i>–ü—Ä–æ—Ü–µ—Å—Å –∑–∞—Ç—è–Ω—É–ª—Å—è...</i> –≠—Ç–∞–ø –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è.`);
      }
      if(G.stageIdx>=STAGES.length){ endGame(true,'–û—Ñ—Ñ–µ—Ä!'); return; }
      if(Math.random()<0.15){
        G.confidence = Math.max(0, G.confidence-1);
        log(`<span style="color:#ffcc99">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ö–∞–æ—Å:</span> –ø–æ—Ç–µ—Ä—è -1 —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ —Ä–æ–≤–Ω–æ–º –º–µ—Å—Ç–µ.`);
        if(G.confidence<=0){ endGame(false,'–í—ã –≤—ã–≥–æ—Ä–µ–ª–∏'); return; }
      }
      G.stress = Math.max(0, G.stress - 1);
      updateUI();
    }
  }

  function finishCombat(reason){
    G.rDiscard.push(G.currentRCard); G.currentRCard=null; G.awaitingResponse=false;
    G.stress = Math.min(WIN_STRESS, G.stress + 1);
    log(`<b>–ö–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∞ —É—Å–ø–µ—à–Ω–∞.</b> –°—Ç—Ä–µ—Å—Å —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞ +1.`);
    if(Math.random()<0.85){
      G.stageIdx++;
      log(`<b>–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à—ë–Ω.</b> –í—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –¥–∞–ª—å—à–µ.`);
    } else {
      log(`<i>–†–µ–∫—Ä—É—Ç–µ—Ä –∑–∞–ø—Ä–æ—Å–∏–ª –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤—å—é...</i>`);
    }
    if(G.stageIdx>=STAGES.length){ endGame(true,'–û—Ñ—Ñ–µ—Ä!'); return; }
    updateUI();
  }

  function endGame(playerWon, cause){
    G.over = true; G.awaitingResponse=false; G.currentRCard=null;
    if(playerWon){
      G.offersSession++;
      G.totals.totalOffers++;
      saveTotals(G.totals);
      sendResult('offer').then(fetchGlobalTotals);
      log(`<span style=\"color:#9dffc9\"><b>–í—ã –ø–æ–±–µ–¥–∏–ª–∏!</b> ${cause}</span>`);
    } else {
      G.refusalsSession++;
      G.totals.totalRefusals++;
      saveTotals(G.totals);
      sendResult('refusal').then(fetchGlobalTotals);
      log(`<span style=\"color:#ffc1c1\"><b>–ü–æ—Ä–∞–∂–µ–Ω–∏–µ.</b> ${cause}</span>`);
    }
    if(G.stress>=WIN_STRESS && playerWon===false){
      log(`<span style=\"color:#cfe5ff\">–°—Ç—Ä–µ—Å—Å —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞ –±—ã–ª –≤—ã—Å–æ–∫–∏–º (${G.stress}), –Ω–æ —Å—É–¥—å–±–∞ —Ä–µ—à–∏–ª–∞ –∏–Ω–∞—á–µ.</span>`);
    }
    updateUI();
  }

  function restart(){
    Object.assign(G,{
      stageIdx:0, confidence:MAX_CONF, stress:0,
      rDeck:recruiterDeck(), rHand:[], rDiscard:[],
      cDeck:candidateDeck(), cHand:[], cDiscard:[],
      currentRCard:null, awaitingResponse:false, over:false,
      offersSession:G.offersSession, refusalsSession:G.refusalsSession,
      totals:G.totals, global:G.global
    });
    el('#log').innerHTML='';
    log('–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –ø–∞—Ä—Ç–∏—è. –ü—Ä–æ–π–¥–∏—Ç–µ 4 —ç—Ç–∞–ø–∞, –Ω–µ –ø–æ—Ç–µ—Ä—è–≤ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.');
    draw(G.rHand, G.rDeck, G.rDiscard, HAND_R);
    draw(G.cHand, G.cDeck, G.cDiscard, HAND_C);
    updateUI();
  }

  document.getElementById('restart').addEventListener('click', restart);
  document.getElementById('resetTotals').addEventListener('click', ()=>{
    if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –æ–±—â–∏–π —Å—á—ë—Ç –æ—Ñ—Ñ–µ—Ä–æ–≤/–æ—Ç–∫–∞–∑–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ?')){
      G.totals = {totalOffers:0,totalRefusals:0};
      saveTotals(G.totals);
      updateUI();
      log('–û–±—â–∏–π —Å—á—ë—Ç –æ—á–∏—â–µ–Ω.');
    }
  });
  // Auto-start
  restart();
  fetchGlobalTotals();
  </script>
</body>
</html>
